var htmel=function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(exports,e,t){o.o(exports,e)||Object.defineProperty(exports,e,{enumerable:!0,get:t})},o.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);const n="Text/CSS node",s="Attribute value",i="Attribute name",r="HTML tag";function a(e,t){const o=[{type:n,xpath:`.//text()[contains(., '${t}')]`},{type:s,xpath:`.//@*[contains(., '${t}')]`},{type:i,xpath:`.//@*[contains(name(), '${t}')]`},{type:r,xpath:`.//*[contains(name(), '${t}')]`}];for(let t of o){let o=document.evaluate(t.xpath,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=o)return{domNode:o,searchLocation:t.type}}}class l{constructor(e,t,o){this.expressions=e,this.domNode=t,this.expressionsLocation=o,this.initialValue={[n]:()=>t.data,[s]:()=>t.value}[o]()}update(){this.expressionsLocation===n?this.updateTextNodeValue():this.updateAttributeNodeValue()}updateTextNodeValue(){let e=this.expressions[0].lastResult;if(this._lastTextNodeValue instanceof Array){for(let e of this._arrayDomNodes)e.remove();this._arrayDomNodes=[]}if(e instanceof Array){this._arrayDomNodes=e.map(e=>"object"==typeof e?e:document.createTextNode(e));let t=document.createElement("htmel-list-container");this.domNode.replaceWith(t),this.domNode=t;for(let e of this._arrayDomNodes)this.domNode.appendChild(e)}else if("object"==typeof e)this.domNode.replaceWith(e),this.domNode=e;else if("object"==typeof this._lastTextNodeValue){let t=document.createTextNode(e);this.domNode.replaceWith(t),this.domNode=t}else this.domNode.data=e;this._lastTextNodeValue=e}updateAttributeNodeValue(){if(this.expressionsLocation===s&&this.expressions[0].isEventHandler){if(this.expressions.length>1){throw`HTMEL: Cant have more than one expression as event handler: ${c(this.initialValue,this.expressions)}`}this._setEventListener()}else{let e=this.expressions[0].lastResult;if(1===this.expressions.length&&["function","object"].includes(typeof e))this.domNode.ownerElement[this.domNode.name]=e,this.domNode.value=e;else{let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this.domNode.ownerElement[this.domNode.name]=void 0,this.domNode.value=e}}}_setEventListener(){let e=this.domNode.name.substring(2);this.domNode.ownerElement.addEventListener(e,(...e)=>{const t=this.expressions[0].lastResult(...e);return"function"==typeof t?t(...e):t}),this.domNode.ownerElement.removeAttributeNode(this.domNode)}}class d{constructor(e){this._cb=e,this.id=new Array(4).fill(0).map(()=>Math.random().toString(36).substr(2,9)).join("-"),this.lastResult=null,this.boundNode=null,this.isEventHandler=!1,this.isStatic="function"!=typeof this._cb}execute(){this.isEventHandler||this.isStatic?this.lastResult=this._cb:this.lastResult=this._cb()}}function u(e,t){let o=e.data,n=e.data.indexOf(t),s=n+t.length;return 0!==n&&e.parentNode.insertBefore(document.createTextNode(o.substring(0,n)),e),s<o.length&&e.parentNode.insertBefore(document.createTextNode(o.substring(s)),e.nextSibling),e.data=o.substring(n,s),e}function c(e,t){for(let o of t)e=e.replace(o.id,"${"+o._cb.toString()+"}");return e}t.default=function(...e){return(t,...o)=>{const h=o.map(e=>new d(e)),f=function(e){const t=document.createElement("template");if(t.innerHTML=e,t.content.children.length>1);else if(0===t.content.children.length)throw"HTMEL: Component can't be empty";return t.content.firstElementChild}((p=t,h.map(e=>e.id).reduce((e,t,o)=>e+t+p[o+1],p[0])));var p;!function(e,t){const o=new Map;for(let d of t){let t=a(e,d.id);if(null==t)throw`HTMEL: Expression location is not valid: ${"${"+d._cb.toString()+"}"}`;let{domNode:h,searchLocation:f}=t;if(f===n&&(h=u(h,d.id)),f===r){throw`HTMEL: Calculating element name is not allowed: ${c(`<${h.localName}>`,[d])}`}if(f===i){throw`HTMEL: Calculating attribute name is not allowed: ${c(h.localName,[d])}`}if(f===s&&h.name.startsWith("on")&&(d.isEventHandler=!0),o.has(h)){let e=o.get(h);e.expressions.push(d),d.boundNode=e}else{let e=new l([d],h,f);o.set(h,e),d.boundNode=e}}}(f,h);let m=!1,b=new Set,N=new Set;e.forEach((e,t)=>{if("object"!=typeof e)throw`HTMEL: Props object must be an object, got ${typeof e}`;!function(e,t,o){const n={},s=s=>{Object.defineProperty(e,s,{get:()=>(t&&t(s),n[s]),set(e){n[s]=e,o&&o(s,e)}})},i=Object.getOwnPropertyDescriptors(e);for(let t of Object.keys(i))n[t]=e[t],s(t);Object.setPrototypeOf(e,new Proxy(n,{get(t,o){s(o),Reflect.get(e,o)},set:(t,o,n)=>(s(o),e[o]=n,!0)}))}(e,e=>m&&N.add(`state${t}.${e}`),(e,o)=>{b.add(`state${t}.${e}`),y()})});let x=new Map;const y=function(e,t){let o,n,s,i=null,r=0,a=function(){r=Date.now(),i=null,s=e.apply(o,n),i||(o=n=null)};return function(){let l=Date.now(),d=t-(l-r);return o=this,n=arguments,d<=0||d>t?(i&&(clearTimeout(i),i=null),r=l,s=e.apply(o,n),i||(o=n=null)):i||(i=setTimeout(a,d)),s}}(()=>{let e=new Set;for(let t of b){let o=x.get(t);o&&o.forEach(t=>e.add(t))}b.clear(),g([...e])},1e3/60),g=e=>{for(let t of e)m=!0,t.execute(),m=!1,N.forEach(e=>{x.has(e)||x.set(e,new Set),x.get(e).add(t)}),N.clear();for(let t of new Set(e.map(e=>e.boundNode)))t.update()};return g(h),f}}}]);export default htmel.default
