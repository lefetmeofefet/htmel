var htmel=function(e){var t={};function o(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,o),l.l=!0,l.exports}return o.m=e,o.c=t,o.d=function(exports,e,t){o.o(exports,e)||Object.defineProperty(exports,e,{enumerable:!0,get:t})},o.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)o.d(n,l,function(t){return e[t]}.bind(null,l));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);const n="Text/CSS node",l="Attribute value",r="Attribute name",i="HTML Element";function s(e,t){const o=[{xpath:`.//text()[contains(., '${t}')]`,resolver:e=>{e.parentNode;const o=(e=function(e,t){let o=e.data,n=e.data.indexOf(t);var l,r;return 0!==n&&(l=document.createTextNode(o.substring(0,n)),(r=e).parentNode.insertBefore(l,r)),n+t.length<o.length&&function(e,t){t.parentNode.insertBefore(e,t.nextSibling)}(document.createTextNode(o.substring(n+t.length)),e),e.data=o.substring(n,n+t.length),e}(e,t)).data;return{domNode:e,type:n,initialValue:o,updateDomNodeCb:t=>e.data=t}}},{xpath:`.//@*[contains(., '${t}')]`,resolver:e=>{e.name;const t=e.value;e.ownerElement;return{domNode:e,type:l,initialValue:t,updateDomNodeCb:t=>e.value=t}}},{xpath:`.//@*[contains(name(), '${t}')]`,resolver:e=>{let t=e.name;e.value;const o=e.ownerElement;return{domNode:e,type:r,initialValue:t,updateDomNodeCb:e=>{let n=o.getAttribute(t);o.removeAttribute(t),null!=e&&""!==e&&(o.setAttribute(e,n),t=e)}}}},{xpath:`.//*[contains(name(), '${t}')]`,resolver:e=>{let t=e;return{domNode:e,type:i,initialValue:e,updateDomNodeCb:e=>{t.replaceWith(e),t=e}}}}];for(let t of o){let o=document.evaluate(t.xpath,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=o)return t.resolver(o)}}class a{constructor(e,t,o,l,r){this.expressions=e,this.domNode=t,this.type=o,this.updateDomNodeCb=l,this.initialValue=r,o===n&&"style"!==t.parentElement.localName?this.updateCb=this.updateTextNodeValue():this.updateCb=this.updateNodeValue()}update(){this.updateCb()}updateTextNodeValue(){let e=this.expressions[0],t="",o=[];return()=>{let n=e.lastResult;if(t instanceof Array){for(let e of o)e!==this.domNode&&e.remove();o=[]}if(n instanceof Array){o=n.map(e=>"object"==typeof e?e:document.createTextNode(e));let e=this.domNode;for(let t of o)e.parentNode.insertBefore(t,e.nextSibling),e=t;this.domNode.remove(),this.domNode=o[0]}else if("object"==typeof n)this.domNode.replaceWith(n),this.domNode=n;else if("object"==typeof t){let e=document.createTextNode(n);this.domNode.replaceWith(e),this.domNode=e}else this.updateDomNodeCb(n);t=n}}updateNodeValue(){let e=null,t=this.expressions[0];return()=>{if(this.type===l&&1===this.expressions.length&&"function"==typeof this.expressions[0].lastResult){if(null==e){let t=this.domNode.name.substring(2);this.domNode.ownerElement.addEventListener(t,(...t)=>e(...t)),this.domNode.ownerElement.removeAttributeNode(this.domNode),this.updateDomNodeCb()}e=t.lastResult}else{let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this.type,this.updateDomNodeCb(e)}}}}class d{constructor(e){this._cb=e,this.id=new Array(4).fill(0).map(()=>Math.random().toString(36).substr(2,9)).join("-"),this.lastResult=null,this.boundNode=null,this.isEvent=!1}execute(){this.isEvent?this.lastResult=this._cb:this.lastResult=this._cb()}}function u(e,t){e=`<${e}>`;for(let o of t)e=e.replace(o.id,"${"+o._cb.toString()+"}");return e}t.default=function(e,t=60){return(o,...n)=>{let c=n.find(e=>"function"!=typeof e);if(c)throw`HTMEL: All of the expressions must be callbacks (change "${c}" to "() => ${c}")`;let f=n.map(e=>new d(e)),p=function(e){let t=document.createElement("template");if(t.innerHTML=e,t.content.children.length>1);else if(0===t.content.children.length)throw"HTMEL: Component can't be empty";return t.content.firstElementChild}((m=o,f.map(e=>e.id).reduce((e,t,o)=>e+t+m[o+1],m[0])));var m;!function(e,t){let o=new Map;for(let n of t){let t=s(e,n.id);if(o.has(t.domNode)){let e=o.get(t.domNode);if(e.domNodeInfo.type!==t.type){let o=`${e.domNodeInfo.domNode.name}="${e.domNodeInfo.domNode.value}"`;if(o=u(o,[n,...e.expressions]),e.domNodeInfo.type===r&&t.type===l)throw`HTMEL: Attribute can't be bound in both name and value (${o})`;throw`HTMEL: Node has multiple expression types: ${o}`}e.expressions.push(n)}else o.set(t.domNode,{domNodeInfo:t,expressions:[n]})}for(let{expressions:e,domNodeInfo:t}of o.values()){if(t.type===i){throw`HTMEL: Calculating element name is not allowed (${u(t.domNode.localName,e)})`}let o=new a(e,t.domNode,t.type,t.updateDomNodeCb,t.initialValue);e.forEach(e=>e.boundNode=o),o.type===l&&o.domNode.name.startsWith("on")&&e.forEach(e=>e.isEvent=!0)}}(p,f);let h=!1,N=new Set,b=new Set;"object"==typeof e&&function(e,t,o){const n={},l={},r=Object.getOwnPropertyDescriptors(e);for(let n of Object.keys(r))l[n]=e[n],Object.defineProperty(e,n,{get:()=>(t&&t(n),l[n]),set(e){l[n]=e,o&&o(n,e)}});Object.setPrototypeOf(e,new Proxy(n,{get:(e,o)=>(t&&t(o),Reflect.get(e,o)||n[o]),set:(e,t,l)=>(Reflect.set(n,t,l),o&&o(t,l),!0)}))}(e,e=>h&&b.add(e),(e,t)=>{N.add(e),g()});let y=new Map;const g=function(e,t,o){let n,l,r,i=null,s=0;o||(o={});let a=function(){s=!1===o.leading?0:Date.now(),i=null,r=e.apply(n,l),i||(n=l=null)};return function(){let d=Date.now();s||!1!==o.leading||(s=d);let u=t-(d-s);return n=this,l=arguments,u<=0||u>t?(i&&(clearTimeout(i),i=null),s=d,r=e.apply(n,l),i||(n=l=null)):i||!1===o.trailing||(i=setTimeout(a,u)),r}}(()=>{let e=new Set;for(let t of N){let o=y.get(t);o&&o.forEach(t=>e.add(t))}N.clear(),x([...e])},1e3/t,{leading:!0}),x=e=>{for(let t of e)h=!0,t.execute(),h=!1,b.forEach(e=>{y.has(e)||y.set(e,new Set),y.get(e).add(t)}),b.clear();for(let t of new Set(e.map(e=>e.boundNode)))t.update()};return x(f),p}}}]);export default htmel.default
